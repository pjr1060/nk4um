<html xmlns:xrl="http://netkernel.org/xrl"
      xmlns:nk4um="http://onegch.org.uk/netkernel/nk4um">
  <head>
    <title><nk4um:title/></title>
    
    <link href="/nk4um/style/jquery-ui-1.8.5.custom.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="/nk4um/style/jquery-1.4.2.min.js"/>
    <script type="text/javascript" src="/nk4um/style/jquery.dataTables.min.js"/>
    
    <link href="/nk4um/style/main.css" rel="stylesheet" type="text/css"/>
    
    <script type="text/javascript">
      jQuery.fn.dataTableExt.oSort['iso-date-asc'] = function ( a, b ) {
        a = $(".post-date", a).text();
        b = $(".post-date", b).text();

			  var x = new Date().setISO8601(a);
        var y = new Date().setISO8601(b);

        if ( isNaN(x) || x==="" )
        {
          x = Date.parse( "01/01/1970 00:00:00" );
        }
        if ( isNaN(y) || y==="" )
        {
          y =	Date.parse( "01/01/1970 00:00:00" );
        }

        return x - y;
      };

		  jQuery.fn.dataTableExt.oSort['iso-date-desc'] = function ( a, b ) {
        a = $(".post-date", a).text();
        b = $(".post-date", b).text();

			  var x = new Date().setISO8601(a);
        var y = new Date().setISO8601(b);

        if ( isNaN(x) || x==="" )
        {
          x = Date.parse( "01/01/1970 00:00:00" );
        }
        if ( isNaN(y) || y==="" )
        {
          y =	Date.parse( "01/01/1970 00:00:00" );
        }

        return y - x;
      }
      
      // http://dansnetwork.com/javascript-iso8601rfc3339-date-parser/
      Date.prototype.setISO8601 = function(dString) {

        var regexp = /(\d\d\d\d)(-)?(\d\d)(-)?(\d\d)(T)?(\d\d)(:)?(\d\d)(:)?(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:)?(\d\d))/;

        if (dString.toString().match(new RegExp(regexp))) {
          var d = dString.match(new RegExp(regexp));
          var offset = 0;

          this.setUTCDate(1);
          this.setUTCFullYear(parseInt(d[1],10));
          this.setUTCMonth(parseInt(d[3],10) - 1);
          this.setUTCDate(parseInt(d[5],10));
          this.setUTCHours(parseInt(d[7],10));
          this.setUTCMinutes(parseInt(d[9],10));
          this.setUTCSeconds(parseInt(d[11],10));
          if (d[12])
            this.setUTCMilliseconds(parseFloat(d[12]) * 1000);
          else
            this.setUTCMilliseconds(0);
          if (d[13] != 'Z') {
            offset = (d[15] * 60) + parseInt(d[17],10);
            offset *= ((d[14] == '-') ? -1 : 1);
            this.setTime(this.getTime() - offset * 60 * 1000);
          }
        } else {
          this.setTime(Date.parse(dString));
        }
        return this;
      };
      
      $(document).ready(function() {
        var columns;
        
        if ($("#forumTable thead tr th").size() == 6) {
          columns= [ null,
                     null,
                     null,
                     { "sType": "iso-date" },
                     null,
                     { "bVisible":    false }
                   ];
        } else {
          columns= [ null,
                     null,
                     null,
                     {"sType": "iso-date" },
                     { "bVisible":    false }
                   ];
        }
        
        $("#forumTable").dataTable({
          "bJQueryUI": true,
          "sPaginationType": "full_numbers",
          "aaSorting": [[3,'desc']],
          "aaSortingFixed": [[$("#forumTable thead tr th").size() - 1,'asc']],
          "aoColumns": columns
        });

        $("#topicTable").dataTable({
          "bJQueryUI": true,
          "sPaginationType": "full_numbers",
          "aaSorting": [[1,'desc']],
          "aoColumns": [ null,
                         { "sType": "iso-date" }
                       ]
        });
        
        $(".dataTables_filter input").get(0).type="search";
        $(".dataTables_wrapper .fg-toolbar:first-child").append($("#button-bar"));
      });
    </script>
    
    <nk4um:head/>
  </head>
  <body>
    <div id="content">
      <div id="header">
        <div id="header-content">
          <div id="site-buttons">
            <xrl:include>
              <xrl:identifier>nk4um:web:navigation</xrl:identifier>
            </xrl:include>
          </div>
          <h1><nk4um:heading/></h1>
          <div id="tag-line"><nk4um:tagLine/></div>
        </div>
        <div id="breadcrumbs">
          <nk4um:breadcrumbs/>
        </div>
      </div>
      
      <xrl:include>
        <xrl:identifier>nk4um:web:message</xrl:identifier>
      </xrl:include>
      
      <nk4um:content/>
      
    </div>
  </body>
</html>
